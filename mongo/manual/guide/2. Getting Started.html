<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>2 Getting Started 1.3.0.GA</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/1.%20Introduction.html"><strong>1</strong><span>Introduction</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/2.%20Getting%20Started.html"><strong>2</strong><span>Getting Started</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/3.%20Mapping%20Domain%20Classes%20to%20Mongo%20Collections.html"><strong>3</strong><span>Mapping Domain Classes to Mongo Collections</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/4.%20Low-level%20API.html"><strong>4</strong><span>Low-level API</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/5.%20Transactions.html"><strong>5</strong><span>Transactions</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/6.%20Unit%20Testing.html"><strong>6</strong><span>Unit Testing</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        
    </div>
    <p></p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/1.%20Introduction.html">&lt;&lt; <strong>1</strong><span>Introduction</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/3.%20Mapping%20Domain%20Classes%20to%20Mongo%20Collections.html"><strong>3</strong><span>Mapping Domain Classes to Mongo Collections</span> >></a></div>
                


                <div class="project">
                    <h1>2 Getting Started - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Graeme Rocher, Burt Beckwith</p>

                    <p><strong>Version:</strong> 1.3.0.GA</p>

                    
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#2.1%20Using%20Mongo%20Standalone"><strong>2.1</strong><span>Using Mongo Standalone</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#2.2%20Combining%20Mongo%20and%20Hibernate"><strong>2.2</strong><span>Combining Mongo and Hibernate</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#2.3%20Advanced%20Configuration"><strong>2.3</strong><span>Advanced Configuration</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="2. Getting Started">2 Getting Started</h1>
To get started with GORM for Mongo you need configure it as a dependency in <code>BuildConfig.groovy</code>:<p class="paragraph"/><div class="code"><pre>plugins &#123;
	compile ':mongodb:1.2.0' // or whatever is the latest vesrion
&#125;</pre></div><p class="paragraph"/>With that done you need to set up a running MongoDB server. Refer to the <a href="https://www.mongodb.org/display/DOCS/Quickstart" target="blank">MongoDB Quick Start guide</a> for an explanation on how to startup a Mongo instance. Once installed starting Mongo is typically a matter of executing the following command:<p class="paragraph"/><div class="code"><pre>MONGO_HOME/bin/mongod</pre></div><p class="paragraph"/>With the above commands executed in a terminal window you should see output like the following appear:<p class="paragraph"/><div class="code"><pre>Thu Nov 11 16:54:08 MongoDB starting : pid=4600 port=27017 dbpath=/data/db/ 64&#45;bit
Thu Nov 11 16:54:08 db version v1.6.3, pdfile version 4.5
Thu Nov 11 16:54:08 git version: 278bd2ac2f2efbee556f32c13c1b6803224d1c01
Thu Nov 11 16:54:08 sys info: Darwin erh2.10gen.cc 9.6.0 Darwin Kernel Version 9.6.0: Mon Nov 24 17:37:00 PST 2008; root:xnu&#45;1228.9.59~1/RELEASE_I386 i386 BOOST_LIB_VERSION=1_40
Thu Nov 11 16:54:08 &#91;initandlisten&#93; waiting <span class="java&#45;keyword">for</span> connections on port 27017
Thu Nov 11 16:54:08 &#91;websvr&#93; web admin <span class="java&#45;keyword">interface</span> listening on port 28017</pre></div><p class="paragraph"/>As you can see the server is running on port 27017, but don't worry the Mongodb plugin for Grails will automatically configure itself to look for Mongodb on that port by default.<p class="paragraph"/>If you want to configure how Grails connects to Mongo then you can do so using the following settings in <code>grails-app/conf/DataSource.groovy</code>:<p class="paragraph"/><div class="code"><pre>grails &#123;
    mongo &#123;
        host = <span class="java&#45;quote">"localhost"</span>
        port = 27017
        username = <span class="java&#45;quote">"blah"</span>
        password = <span class="java&#45;quote">"blah"</span>
        databaseName = <span class="java&#45;quote">"foo"</span>
    &#125;
&#125;</pre></div>



<h2 id="2.1 Using Mongo Standalone">2.1 Using Mongo Standalone</h2>
If you plan to use Mongo as your primary datastore then you need to remove the Hibernate plugin from the <code>grails-app/conf/BuildConfig.groovy</code> file by commenting out the hibernate line in the plugins block<p class="paragraph"/><div class="code"><pre>compile ':hibernate:2.0.0'</pre></div><p class="paragraph"/>With this done all domain classes in grails-app/domain will be persisted via Mongo and not Hibernate. You can create a domain class by running the regular <code>create-domain-class</code> command:<p class="paragraph"/><div class="code"><pre>grails create&#45;domain&#45;class Person</pre></div><p class="paragraph"/>The <code>Person</code> domain class will automatically be a persistent entity that can be stored in Mongo.



<h2 id="2.2 Combining Mongo and Hibernate">2.2 Combining Mongo and Hibernate</h2>
If you have both the Hibernate and Mongo plugins installed then by default all classes in the <code>grails-app/domain</code> directory will be persisted by Hibernate and not Mongo. If you want to persist a particular domain class with Mongo then you must use the <code>mapWith</code> property in the domain class:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mapWith = <span class="java&#45;quote">"mongo"</span></pre></div><p class="paragraph"/>Alternatively you can persist Hibernate entities to Mongo using the special <code>mongo</code> scope added to all Hibernate entities:<p class="paragraph"/><div class="code"><pre>def hibernatePerson = Person.get(1)<p class="paragraph"/>hibernatePerson.mongo.save()<p class="paragraph"/>def mongoPerson = Person.mongo.get(1)</pre></div><p class="paragraph"/>


<h2 id="2.3 Advanced Configuration">2.3 Advanced Configuration</h2>
<h4>Mongo Database Connection Configuration</h4><p class="paragraph"/>As mentioned the GORM for Mongo plugin will configure all the defaults for you, but if you wish to customize those defaults you can do so in the your <code>grails-app/conf/DataSource.groovy</code> file:<p class="paragraph"/><div class="code"><pre>grails &#123;
    mongo &#123;
        host = <span class="java&#45;quote">"localhost"</span>
        port = 27107
        username = <span class="java&#45;quote">"blah"</span>
        password = <span class="java&#45;quote">"blah"</span>
        databaseName = <span class="java&#45;quote">"foo"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>The <code>databaseName</code> setting configures the default database name. If not specified the <code>databaseName</code> will default to the name of your application.<p class="paragraph"/>You can also customize the Mongo connection settings using an <code>options</code> block:<p class="paragraph"/><div class="code"><pre>grails &#123;
    mongo &#123;
        options &#123;
            autoConnectRetry = <span class="java&#45;keyword">true</span>
            connectTimeout = 300
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>Available options and their descriptions are defined in the <a href="https://api.mongodb.org/java/current/com/mongodb/MongoOptions.html" target="blank">MongoOptions</a> javadoc.<p class="paragraph"/>In production scenarios you will typically use more than one Mongo server in either <a href="https://www.mongodb.org/display/DOCS/Master+Slave" target="blank">master/slave</a> or <a href="https://www.mongodb.org/display/DOCS/Replication" target="blank">replication</a> scenarios. The plugin allows you to configure <a href="https://www.mongodb.org/display/DOCS/Replica+Pairs" target="blank">replica pairs</a>:<p class="paragraph"/><div class="code"><pre>grails &#123;
    mongo &#123;
        replicaPair = &#91; <span class="java&#45;quote">"localhost:27017"</span>, <span class="java&#45;quote">"localhost:27018"</span>&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/>Or <a href="https://www.mongodb.org/display/DOCS/Replica+Sets" target="blank">replica sets</a>:<p class="paragraph"/><div class="code"><pre>grails &#123;
    mongo &#123;
        replicaSet = &#91; <span class="java&#45;quote">"localhost:27017"</span>, <span class="java&#45;quote">"localhost:27018"</span>&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/>The replica sets are defined using a list of strings that conform to the Mongo <a href="https://api.mongodb.org/java/current/com/mongodb/DBAddress.html" target="blank">DBAddress</a> specification.<p class="paragraph"/><h4>Global Mapping Configuration</h4><p class="paragraph"/>Using the <code>grails.mongo.default.mapping</code> setting in <code>Config.groovy</code> you can configure global mapping options across your domain classes. This is useful if, for example, you want to disable optimistic locking globally or you wish to use <code>DBRefs</code> in your association mappings. For example, the following configuration will disable optimistic locking globally and use <code>DBRefs</code> for all properties:<p class="paragraph"/><div class="code"><pre>grails.mongo.<span class="java&#45;keyword">default</span>.mapping = &#123;
    version <span class="java&#45;keyword">false</span>
    '&#42;'(reference:<span class="java&#45;keyword">true</span>)
&#125;</pre></div><p class="paragraph"/>The <code>*</code> method is used to indicate that the setting applies to all properties.



                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/1.%20Introduction.html">&lt;&lt; <strong>1</strong><span>Introduction</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/3.%20Mapping%20Domain%20Classes%20to%20Mongo%20Collections.html"><strong>3</strong><span>Mapping Domain Classes to Mongo Collections</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Beans</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../ref/Beans/mongo.html">mongo</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Domain Classes</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/DB.html">DB</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/collection.html">collection</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/collectionName.html">collectionName</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/dbo.html">dbo</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/useCollection.html">useCollection</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/useDatabase.html">useDatabase</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/withCollection.html">withCollection</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/withDatabase.html">withDatabase</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Testing</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../ref/Testing/DatastoreUnitTestMixin.html">DatastoreUnitTestMixin</a>
                            </div>
                            
                            </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
