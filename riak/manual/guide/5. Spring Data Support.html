<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>5 Spring Data Support 1.0.0.M4</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/1.%20Introduction.html"><strong>1</strong><span>Introduction</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/2.%20Getting%20Started.html"><strong>2</strong><span>Getting Started</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/3.%20Object%20Mapping.html"><strong>3</strong><span>Object Mapping</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/4.%20Querying.html"><strong>4</strong><span>Querying</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/5.%20Spring%20Data%20Support.html"><strong>5</strong><span>Spring Data Support</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/6.%20Map%20Reduce%20Support.html"><strong>6</strong><span>Map Reduce Support</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/7.%20Testing.html"><strong>7</strong><span>Testing</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        
    </div>
    <p></p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/4.%20Querying.html">&lt;&lt; <strong>4</strong><span>Querying</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/6.%20Map%20Reduce%20Support.html"><strong>6</strong><span>Map Reduce Support</span> >></a></div>
                


                <div class="project">
                    <h1>5 Spring Data Support - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Jon Brisbin, Graeme Rocher</p>

                    <p><strong>Version:</strong> 1.0.0.M4</p>

                    
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#5.1%20RiakBuilder%20Support"><strong>5.1</strong><span>RiakBuilder Support</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="5. Spring Data Support">5 Spring Data Support</h1>
The Riak support for GORM is actually built on top of the Riak support for <a href="https://www.springsource.org/spring-data" target="blank">Spring Data</a>. As such, the Riak plugin provides full access to a <code>org.springframework.data.keyvalue.riak.core.RiakTemplate</code> or <code>org.springframework.data.keyvalue.riak.core.AsyncRiakTemplate</code> object you can inject into your own components. The former is for synchronous access to Riak, the latter is for asynchronous access.<p class="paragraph"/>For example, in a controller:<p class="paragraph"/><div class="code"><pre>class MyController &#123;
    def riakTemplate<p class="paragraph"/>    def foo = &#123;
        def notifs = riak.get(<span class="java&#45;quote">"notifications"</span>, <span class="java&#45;quote">"myuser"</span>)
        render <span class="java&#45;quote">"Notifications: &#36;notifs"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>Or, for asynchronous access:<p class="paragraph"/><div class="code"><pre>class MyController &#123;
    def asyncRiakTemplate<p class="paragraph"/>    def foo = &#123;
        def callback = &#91;
            completed: &#123; metadata, val &#45;&#62;
                // Since <span class="java&#45;keyword">this</span> is run asynchronously,
                // put the data somewhere <span class="java&#45;keyword">else</span>&#8230;
            &#125;,
            failed: &#123; err &#45;&#62;
                log.error(err.message, err)
            &#125;
        &#93; as AsyncKeyValueStoreOperation
        riak.get(<span class="java&#45;quote">"notifications"</span>, <span class="java&#45;quote">"myuser"</span>, callback)<p class="paragraph"/>        // The previous call doesn't block, so we <span class="java&#45;keyword">continue</span> on&#8230;
        render <span class="java&#45;quote">"Notifications: &#36;notifs"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>See the Spring Data reference for more information on the methods available and on examples of using the <code>RiakTemplate</code> in your own code.



<h2 id="5.1 RiakBuilder Support">5.1 RiakBuilder Support</h2>
Besides direct access to the Java-language template objects, the Riak plugin for Grails exposes a Groovy Builder object call RiakBuilder for use in your controllers and services. The builder uses a declarative, DSL-style syntax for working with Riak.<p class="paragraph"/>For example, to delete all entries in a bucket using the RiakBuilder DSL (which is a dynamic method the plugin adds to any controller or service class):<p class="paragraph"/><div class="code"><pre>riak &#123;
  test &#123;
    foreach &#123;
      completed &#123; v, meta &#45;&#62; delete(key: meta.key) &#125;
      failed &#123; it.printStackTrace() &#125;
    &#125;
  &#125;
&#125;</pre></div>
<ul class="star">
<li>The top-level node should always be "riak".</li>
<li>The next level is optional. In this case, it sets the default bucket name to "test", so it's not necessary to specify it on operations contained within this block.</li>
<li>When an operation is complete, if a "completed" closure is defined, the builder will call that closure, passing the results of the operation as the first parameter and optionally passing the metadata associated with that entry as the second (this might be null, depending on the context in which the completed closure is called). If no parameters are defined, the result of the operation is still available as the implicit variable "it".</li>
<li>To handle errors, a "failed" closure should be defined, which should accept the exception just generated (the exception is also available as "it").</li>
</ul><p class="paragraph"/>See the Spring Data reference for more information on the methods available and on examples of using the <code>RiakBuilder</code> in your own code.


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/4.%20Querying.html">&lt;&lt; <strong>4</strong><span>Querying</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/6.%20Map%20Reduce%20Support.html"><strong>6</strong><span>Map Reduce Support</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Beans</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../ref/Beans/asyncRiakTemplate.html">asyncRiakTemplate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Beans/riak.html">riak</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Beans/riakTemplate.html">riakTemplate</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Domain Classes</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/mapreduce.html">mapreduce</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Testing</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../ref/Testing/DatastoreUnitTestMixin.html">DatastoreUnitTestMixin</a>
                            </div>
                            
                            </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
